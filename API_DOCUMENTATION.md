# API Documentation

This document provides comprehensive API documentation for all microservices in the educational management system.

## Base URLs

When accessing through the API Gateway:
- **Gateway URL**: `http://<gateway-host>:9090`
- **Kubernetes NodePort**: `http://<node-ip>:30909`

Direct service access (internal to cluster):
- **Course Service**: `http://course-service:8883`
- **Student Service**: `http://student-service:8882`
- **Address Service**: `http://address-service:8881`
- **Eureka Server**: `http://eureka-server:8761`

## Authentication

Currently, the system does not implement authentication. All endpoints are publicly accessible.

> **Note**: In a production environment, consider implementing JWT-based authentication through the API Gateway.

## Common Headers

All requests should include:
```
Content-Type: application/json
Accept: application/json
```

The Gateway automatically adds correlation IDs for request tracing:
```
X-Correlation-ID: <auto-generated-uuid>
```

## Course Service API

Base path: `/courses`

### Create Course
**POST** `/courses`

Creates a new course in the system.

**Request Body:**
```json
{
  "name": "Introduction to Microservices",
  "description": "Learn the fundamentals of microservices architecture",
  "instructor": "Dr. Jane Smith",
  "department": "Computer Science"
}
```

**Response:** `201 Created`
```json
{
  "courseId": 1,
  "name": "Introduction to Microservices",
  "description": "Learn the fundamentals of microservices architecture",
  "instructor": "Dr. Jane Smith",
  "department": "Computer Science"
}
```

**Error Responses:**
- `400 Bad Request` - Invalid request body
- `500 Internal Server Error` - Database error

---

### Get All Courses
**GET** `/courses`

Retrieves all courses in the system.

**Response:** `200 OK`
```json
[
  {
    "courseId": 1,
    "name": "Introduction to Microservices",
    "description": "Learn the fundamentals of microservices architecture",
    "instructor": "Dr. Jane Smith",
    "department": "Computer Science"
  },
  {
    "courseId": 2,
    "name": "Advanced Java Programming",
    "description": "Deep dive into Java advanced concepts",
    "instructor": "Prof. John Doe",
    "department": "Computer Science"
  }
]
```

---

### Get Course by ID
**GET** `/courses/{courseId}`

Retrieves a specific course by its ID.

**Path Parameters:**
- `courseId` (Long) - The unique identifier of the course

**Response:** `200 OK`
```json
{
  "courseId": 1,
  "name": "Introduction to Microservices",
  "description": "Learn the fundamentals of microservices architecture",
  "instructor": "Dr. Jane Smith",
  "department": "Computer Science"
}
```

**Error Responses:**
- `404 Not Found` - Course not found

---

### Update Course
**PUT** `/courses/{courseId}`

Updates an existing course.

**Path Parameters:**
- `courseId` (Long) - The unique identifier of the course

**Request Body:**
```json
{
  "name": "Advanced Microservices Architecture",
  "description": "Deep dive into microservices patterns and practices",
  "instructor": "Dr. Jane Smith",
  "department": "Computer Science"
}
```

**Response:** `200 OK`
```json
{
  "courseId": 1,
  "name": "Advanced Microservices Architecture",
  "description": "Deep dive into microservices patterns and practices",
  "instructor": "Dr. Jane Smith",
  "department": "Computer Science"
}
```

**Error Responses:**
- `404 Not Found` - Course not found
- `400 Bad Request` - Invalid request body

---

### Delete Course
**DELETE** `/courses/{courseId}`

Deletes a course from the system.

**Path Parameters:**
- `courseId` (Long) - The unique identifier of the course

**Response:** `204 No Content`

**Error Responses:**
- `404 Not Found` - Course not found

---

## Student Service API

Base path: `/students`

### Create Student
**POST** `/students`

Creates a new student in the system.

**Request Body:**
```json
{
  "name": "John Doe",
  "email": "john.doe@example.com",
  "age": 22
}
```

**Response:** `201 Created`
```json
{
  "studentId": 1,
  "name": "John Doe",
  "email": "john.doe@example.com",
  "age": 22
}
```

**Error Responses:**
- `400 Bad Request` - Invalid request body or email already exists
- `500 Internal Server Error` - Database error

---

### Get All Students
**GET** `/students`

Retrieves all students in the system.

**Response:** `200 OK`
```json
[
  {
    "studentId": 1,
    "name": "John Doe",
    "email": "john.doe@example.com",
    "age": 22
  },
  {
    "studentId": 2,
    "name": "Jane Smith",
    "email": "jane.smith@example.com",
    "age": 20
  }
]
```

---

### Get Student by ID
**GET** `/students/{id}`

Retrieves a specific student by their ID.

**Path Parameters:**
- `id` (Long) - The unique identifier of the student

**Response:** `200 OK`
```json
{
  "studentId": 1,
  "name": "John Doe",
  "email": "john.doe@example.com",
  "age": 22
}
```

**Error Responses:**
- `404 Not Found` - Student not found

---

### Update Student
**PUT** `/students/{id}`

Updates an existing student.

**Path Parameters:**
- `id` (Long) - The unique identifier of the student

**Request Body:**
```json
{
  "name": "John Smith",
  "email": "john.smith@example.com",
  "age": 23
}
```

**Response:** `200 OK`
```json
{
  "studentId": 1,
  "name": "John Smith",
  "email": "john.smith@example.com",
  "age": 23
}
```

**Error Responses:**
- `404 Not Found` - Student not found
- `400 Bad Request` - Invalid request body or email already exists

---

### Delete Student
**DELETE** `/students/{id}`

Deletes a student from the system.

**Path Parameters:**
- `id` (Long) - The unique identifier of the student

**Response:** `204 No Content`

**Error Responses:**
- `404 Not Found` - Student not found

---

## Address Service API

Base path: `/address`

### Get Sample Address
**GET** `/address/getAddress`

Returns a sample address for demonstration purposes.

**Response:** `200 OK`
```json
{
  "street": "123",
  "city": "Pune",
  "state": "MH"
}
```

> **Note**: This is a static response for demonstration. In a real implementation, this would likely accept parameters or return user-specific addresses.

---

## Service Discovery API (Eureka)

Base path: `http://eureka-server:8761`

### Eureka Dashboard
**GET** `/`

Provides a web interface to view registered services.

### Service Registry
**GET** `/eureka/apps`

Returns all registered applications in XML format.

**Response:** `200 OK`
```xml
<applications>
  <application>
    <name>GATEWAY</name>
    <instance>
      <hostName>gateway</hostName>
      <port>9090</port>
      <status>UP</status>
    </instance>
  </application>
  <!-- More services... -->
</applications>
```

### Health Check
**GET** `/actuator/health`

Returns the health status of Eureka server.

**Response:** `200 OK`
```json
{
  "status": "UP"
}
```

---

## Error Handling

### Standard Error Response Format

All services return errors in a consistent format:

```json
{
  "timestamp": "2024-08-21T11:05:30.123Z",
  "status": 404,
  "error": "Not Found",
  "message": "Student not found with ID: 123",
  "path": "/students/123"
}
```

### Common HTTP Status Codes

| Code | Meaning | Usage |
|------|---------|-------|
| 200 | OK | Successful GET, PUT requests |
| 201 | Created | Successful POST requests |
| 204 | No Content | Successful DELETE requests |
| 400 | Bad Request | Invalid request body or parameters |
| 404 | Not Found | Resource not found |
| 500 | Internal Server Error | Server-side errors |

---

## Request/Response Examples

### Example 1: Create and Retrieve a Course

**1. Create Course**
```bash
curl -X POST http://localhost:30909/courses \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Spring Boot Fundamentals",
    "description": "Learn Spring Boot framework",
    "instructor": "Dr. Bob Johnson",
    "department": "Computer Science"
  }'
```

**Response:**
```json
{
  "courseId": 3,
  "name": "Spring Boot Fundamentals",
  "description": "Learn Spring Boot framework",
  "instructor": "Dr. Bob Johnson",
  "department": "Computer Science"
}
```

**2. Retrieve Course**
```bash
curl http://localhost:30909/courses/3
```

**Response:**
```json
{
  "courseId": 3,
  "name": "Spring Boot Fundamentals",
  "description": "Learn Spring Boot framework",
  "instructor": "Dr. Bob Johnson",
  "department": "Computer Science"
}
```

### Example 2: Student Management Workflow

**1. Create Student**
```bash
curl -X POST http://localhost:30909/students \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Alice Johnson",
    "email": "alice.johnson@university.edu",
    "age": 21
  }'
```

**2. Update Student**
```bash
curl -X PUT http://localhost:30909/students/1 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Alice Johnson-Smith",
    "email": "alice.johnson@university.edu",
    "age": 22
  }'
```

**3. Get All Students**
```bash
curl http://localhost:30909/students
```

**4. Delete Student**
```bash
curl -X DELETE http://localhost:30909/students/1
```

---

## Testing APIs

### Using curl

Test all endpoints using curl commands shown above.

### Using Postman

Import the following collection structure:

```
Educational Management System APIs
├── Course Service
│   ├── Create Course
│   ├── Get All Courses
│   ├── Get Course by ID
│   ├── Update Course
│   └── Delete Course
├── Student Service
│   ├── Create Student
│   ├── Get All Students
│   ├── Get Student by ID
│   ├── Update Student
│   └── Delete Student
└── Address Service
    └── Get Sample Address
```

### Health Check Script

Create a simple health check script:

```bash
#!/bin/bash
echo "Checking service health..."

# Check Gateway
curl -f http://localhost:30909/actuator/health && echo "Gateway: UP" || echo "Gateway: DOWN"

# Check Eureka
curl -f http://localhost:30909/eureka/apps && echo "Eureka: UP" || echo "Eureka: DOWN"

# Test basic endpoints
curl -f http://localhost:30909/courses && echo "Course Service: UP" || echo "Course Service: DOWN"
curl -f http://localhost:30909/students && echo "Student Service: UP" || echo "Student Service: DOWN"
curl -f http://localhost:30909/address/getAddress && echo "Address Service: UP" || echo "Address Service: DOWN"
```

---

## Rate Limiting and Performance

### Current Implementation
- No rate limiting implemented
- Basic logging for performance monitoring

### Recommendations for Production

1. **Rate Limiting**: Implement rate limiting in the API Gateway
2. **Caching**: Add Redis for caching frequently accessed data
3. **Database Connection Pooling**: Configure optimal connection pools
4. **Async Processing**: Consider async patterns for non-blocking operations

---

## Monitoring API Performance

### Metrics Available

Each service exposes metrics via Spring Boot Actuator:

```bash
# Get application metrics
curl http://localhost:30909/actuator/metrics

# Get specific metric
curl http://localhost:30909/actuator/metrics/http.server.requests
```

### Correlation IDs

All requests through the Gateway receive a correlation ID for tracing:

**Request:**
```bash
curl -H "X-Correlation-ID: my-custom-id" http://localhost:30909/courses
```

**Logs will show:**
```
GW IN => method=GET path=/courses cid=my-custom-id remote=/127.0.0.1:12345 at=2024-08-21T11:05:30.123Z
GW OUT => status=200 OK cid=my-custom-id durationMs=45
```

This enables end-to-end request tracing across all services.